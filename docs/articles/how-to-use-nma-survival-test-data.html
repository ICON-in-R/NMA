<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="NMA">
<title>How to use NMA: Introduction with test data • NMA</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.1.0/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.1.0/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="How to use NMA: Introduction with test data">
<meta property="og:description" content="NMA">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">NMA</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9000</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/how-to-use-nma-test-data.html">Using survival data</a>
    <a class="dropdown-item" href="../articles/reference-file-test-data.html">Reference file</a>
    <a class="dropdown-item" href="../articles/count-data.html">Using binary data</a>
    <a class="dropdown-item" href="../articles/binary-data.html">Using count data</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/ICON-in-R/NMA/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main"><div class="page-header">
      <img src="" class="logo" alt=""><h1>How to use NMA: Introduction with test data</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/ICON-in-R/NMA/blob/HEAD/vignettes/how-to-use-nma-survival-test-data.Rmd" class="external-link"><code>vignettes/how-to-use-nma-survival-test-data.Rmd</code></a></small>
      <div class="d-none name"><code>how-to-use-nma-survival-test-data.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>This document describes how to use the main functions of
<code>NMA</code> to run a single network meta-analysis with survival
data.</p>
</div>
<div class="section level2">
<h2 id="example">Example<a class="anchor" aria-label="anchor" href="#example"></a>
</h2>
<p>First load the required packages.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://icon-in-r.github.io/NMA">NMA</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://purrr.tidyverse.org" class="external-link">purrr</a></span><span class="op">)</span></code></pre></div>
<div class="section level3">
<h3 id="settings">Settings<a class="anchor" aria-label="anchor" href="#settings"></a>
</h3>
<p>Define the BUGS parameters for MCMC. This is not necessary, but
recommended, because there are default values for these.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">bugs_params</span> <span class="op">&lt;-</span>
  <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>
    PROG <span class="op">=</span> <span class="st">"openBugs"</span>,  <span class="co"># which version of BUGS to use to run the MCMC</span>
    N.BURNIN <span class="op">=</span> <span class="fl">10</span>,<span class="co">#00,  # number of steps to throw away</span>
    N.SIMS <span class="op">=</span> <span class="fl">150</span>,<span class="co">#0,    # total number of simulations</span>
    N.CHAINS <span class="op">=</span> <span class="fl">2</span>,       <span class="co"># number of chains</span>
    N.THIN <span class="op">=</span> <span class="fl">1</span>,         <span class="co"># thinning rate</span>
    PAUSE <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<p>Define the scenario we will use for the analysis.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">RANDOM</span> <span class="op">&lt;-</span> <span class="cn">FALSE</span>             <span class="co"># is this a random effects model?</span>
<span class="va">REFTX</span> <span class="op">&lt;-</span> <span class="st">"X"</span>                <span class="co"># reference treatment</span>
<span class="va">data_type</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"hr_data"</span>, <span class="st">"surv_bin_data"</span>, <span class="st">"med_data"</span><span class="op">)</span> <span class="co"># which type of data to use</span>
<span class="va">label_name</span> <span class="op">&lt;-</span> <span class="st">"label_name"</span></code></pre></div>
</div>
<div class="section level3">
<h3 id="read-in-datasets">Read in datasets<a class="anchor" aria-label="anchor" href="#read-in-datasets"></a>
</h3>
<p>The trials data consist of up to 3 separate data frames. A main
table, <code>subData</code>, and optional tables for median event time
and binary data, <code>subDataMed</code> and <code>subDataBin</code>
respectively. Lets read in the each data set separately. In another
article we will show how to do this in one function call by including a
<em>Reference</em> file in the data folder which contains the meta data
of how to read in the study data. If there is no binary or median data
used in the NMA then the variables <code>subDataBin</code> and
<code>subDataMed</code> are assigned <code>NA</code>.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">file_name</span> <span class="op">&lt;-</span> <span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html" class="external-link">here</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="st">"inst"</span>, <span class="st">"extdata"</span>, <span class="st">"survdata_"</span><span class="op">)</span><span class="op">)</span>

<span class="va">subDataHR</span> <span class="op">&lt;-</span>
  <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.csv</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">file_name</span>, <span class="st">"hr_test.csv"</span><span class="op">)</span>,
           header <span class="op">=</span> <span class="cn">TRUE</span>,
           as.is <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>

<span class="va">subDataBin</span> <span class="op">&lt;-</span>
  <span class="kw"><a href="https://rdrr.io/r/base/conditions.html" class="external-link">tryCatch</a></span><span class="op">(</span>
    <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.csv</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">file_name</span>, <span class="st">"bin_test.csv"</span><span class="op">)</span>,
             header <span class="op">=</span> <span class="cn">TRUE</span>,
             as.is <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,
    error <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">e</span><span class="op">)</span> <span class="cn">NA</span><span class="op">)</span>

<span class="va">subDataMed</span> <span class="op">&lt;-</span>
  <span class="kw"><a href="https://rdrr.io/r/base/conditions.html" class="external-link">tryCatch</a></span><span class="op">(</span>
    <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.csv</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">file_name</span>, <span class="st">"med_test.csv"</span><span class="op">)</span>,
             header <span class="op">=</span> <span class="cn">TRUE</span>,
             as.is <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
      <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>medR <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">floor</a></span><span class="op">(</span><span class="va">medR</span><span class="op">)</span><span class="op">)</span>,
    error <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">e</span><span class="op">)</span> <span class="cn">NA</span><span class="op">)</span></code></pre></div>
<p>The format of the data should be fairly self-explanatory and looks
like the following. For the hazard ratio data</p>
<table class="table">
<thead><tr class="header">
<th align="left">study</th>
<th align="left">base</th>
<th align="left">tx</th>
<th align="right">Lmean</th>
<th align="right">Lse</th>
<th align="right">multi_arm</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">A</td>
<td align="left">X</td>
<td align="left">Y</td>
<td align="right">-0.5259393</td>
<td align="right">0.1275307</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">B</td>
<td align="left">Y</td>
<td align="left">Z</td>
<td align="right">-0.7133499</td>
<td align="right">0.1437422</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">C</td>
<td align="left">Z</td>
<td align="left">X</td>
<td align="right">-0.3011051</td>
<td align="right">0.1758496</td>
<td align="right">0</td>
</tr>
</tbody>
</table>
<p>For the binary data</p>
<table class="table">
<thead><tr class="header">
<th align="left">study</th>
<th align="left">base</th>
<th align="left">tx</th>
<th align="right">BinR</th>
<th align="right">BinN</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">A</td>
<td align="left">X</td>
<td align="left">X</td>
<td align="right">34</td>
<td align="right">38</td>
</tr>
<tr class="even">
<td align="left">B</td>
<td align="left">X</td>
<td align="left">Y</td>
<td align="right">27</td>
<td align="right">33</td>
</tr>
</tbody>
</table>
<p>and for the median time data</p>
<table class="table">
<thead><tr class="header">
<th align="left">study</th>
<th align="left">base</th>
<th align="left">tx</th>
<th align="right">median</th>
<th align="right">medN</th>
<th align="right">medR</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">A</td>
<td align="left">X</td>
<td align="left">Y</td>
<td align="right">14.0</td>
<td align="right">45</td>
<td align="right">22</td>
</tr>
<tr class="even">
<td align="left">B</td>
<td align="left">Y</td>
<td align="left">Z</td>
<td align="right">18.0</td>
<td align="right">45</td>
<td align="right">22</td>
</tr>
<tr class="odd">
<td align="left">C</td>
<td align="left">Z</td>
<td align="left">X</td>
<td align="right">15.1</td>
<td align="right">10</td>
<td align="right">5</td>
</tr>
</tbody>
</table>
<p>More information about these data is available in the help
documentation which can be accessed with
e.g. <code>help(subData)</code>.</p>
</div>
<div class="section level3">
<h3 id="build-model">Build model<a class="anchor" aria-label="anchor" href="#build-model"></a>
</h3>
<p>The package uses the model in <span class="citation">Woods, Hawkins,
and Scott (2010)</span> for NMA combining count and hazard ratio
statistics in multi-arm trials. For count data, the cumulative count of
subjects who have experienced an event in arm <span class="math inline">\(k\)</span> of study <span class="math inline">\(s\)</span></p>
<p><span class="math display">\[
r_{s,k} \sim Bin(F_{s,k}, n_{s,k})
\]</span></p>
<p>A log cumulative hazard for each trial arm</p>
<p><span class="math display">\[
\ln (H_{s,k}) = \ln ( - \ln (1 - F_{s,k})))
\]</span></p>
<p>where</p>
<p><span class="math display">\[
\ln (H_{s,k}) = \alpha_s + \beta_k - \beta_b
\]</span></p>
<p>Under an assumption of proportional hazards, the <span class="math inline">\(\beta_k\)</span> coefficient is equal to the log
hazard ratio.</p>
<p>The counts and hazard ratio data can then be used together, placing a
normal distribution error on the log HR.</p>
<p>A random effect is included in the model as follows.</p>
<p><span class="math display">\[
\ln (H_{s,k}) = \alpha_s + \beta_k - \beta_b + re_{s,k} - re_{s,b}
\]</span></p>
<p>Now we can create the NMA object to use in the modelling. The
workflow is to first create this separately to actually doing the
fitting. This then means that we can perform modified fits but we don’t
have to redo any of the preparatory work.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">nma_model</span> <span class="op">&lt;-</span>
  <span class="fu"><a href="../reference/new_NMA.html">new_NMA</a></span><span class="op">(</span>subDataHR <span class="op">=</span> <span class="va">subDataHR</span>,
          subDataMed <span class="op">=</span> <span class="va">subDataMed</span>,
          subDataBin <span class="op">=</span> <span class="va">subDataBin</span>,
          bugs_params <span class="op">=</span> <span class="va">bugs_params</span>,
          is_random <span class="op">=</span> <span class="va">RANDOM</span>,
          data_type <span class="op">=</span> <span class="va">data_type</span>,
          refTx <span class="op">=</span> <span class="va">REFTX</span> ,
          effectParam <span class="op">=</span> <span class="st">"beta"</span>,
          label <span class="op">=</span> <span class="st">""</span>,
          endpoint <span class="op">=</span> <span class="st">""</span><span class="op">)</span>

<span class="va">nma_model</span>
<span class="co">#&gt; $dat</span>
<span class="co">#&gt; $dat$inits</span>
<span class="co">#&gt; function() {</span>
<span class="co">#&gt;     list(</span>
<span class="co">#&gt;       beta = c(NA, rnorm(nTx - 1, 0, 2)),</span>
<span class="co">#&gt;       sd = 0.1,</span>
<span class="co">#&gt;       alpha = rnorm(nStudies),</span>
<span class="co">#&gt;       d = c(NA, rnorm(nTx - 1, 0, 2)),  ##TODO: can we remove duplication?</span>
<span class="co">#&gt;       mu = rnorm(nStudies),</span>
<span class="co">#&gt;       baseLod = 0) %&gt;% </span>
<span class="co">#&gt;       .[param_names]  # filter redundant</span>
<span class="co">#&gt;   }</span>
<span class="co">#&gt; &lt;bytecode: 0x0000000016dbfe30&gt;</span>
<span class="co">#&gt; &lt;environment: 0x0000000016db6850&gt;</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $dat$subDataHR</span>
<span class="co">#&gt;   study base tx      Lmean       Lse multi_arm Ltx Lbase Lstudy</span>
<span class="co">#&gt; 1     A    X  Y -0.5259393 0.1275307         0   2     1      1</span>
<span class="co">#&gt; 2     B    Y  Z -0.7133499 0.1437422         0   3     2      2</span>
<span class="co">#&gt; 3     C    Z  X -0.3011051 0.1758496         0   1     3      3</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $dat$subDataBin</span>
<span class="co">#&gt;   study base tx BinR BinN Btx Bbase Bstudy</span>
<span class="co">#&gt; 1     A    X  X   34   38   1     1      1</span>
<span class="co">#&gt; 2     B    X  Y   27   33   2     1      2</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $dat$subDataMed</span>
<span class="co">#&gt;   study base tx median medN medR mediantx medianbase medianstudy</span>
<span class="co">#&gt; 1     A    X  Y   14.0   45   22        2          1           1</span>
<span class="co">#&gt; 2     B    Y  Z   18.0   45   22        3          2           2</span>
<span class="co">#&gt; 3     C    Z  X   15.1   10    5        1          3           3</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $dat$bugsData</span>
<span class="co">#&gt; $dat$bugsData$mu_beta</span>
<span class="co">#&gt; [1] 0</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $dat$bugsData$prec_beta</span>
<span class="co">#&gt; [1] 1e-06</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $dat$bugsData$mu_alpha</span>
<span class="co">#&gt; [1] 0</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $dat$bugsData$prec_alpha</span>
<span class="co">#&gt; [1] 1e-06</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $dat$bugsData$Lstudy</span>
<span class="co">#&gt; [1] 1 2 3</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $dat$bugsData$Ltx</span>
<span class="co">#&gt; [1] 2 3 1</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $dat$bugsData$Lbase</span>
<span class="co">#&gt; [1] 1 2 3</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $dat$bugsData$Lmean</span>
<span class="co">#&gt; [1] -0.5259393 -0.7133499 -0.3011051</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $dat$bugsData$Lse</span>
<span class="co">#&gt; [1] 0.1275307 0.1437422 0.1758496</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $dat$bugsData$multi</span>
<span class="co">#&gt; [1] 0 0 0</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $dat$bugsData$LnObs</span>
<span class="co">#&gt; [1] 3</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $dat$bugsData$nTx</span>
<span class="co">#&gt; [1] 3</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $dat$bugsData$nStudies</span>
<span class="co">#&gt; [1] 3</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $dat$bugsData$medianStudy</span>
<span class="co">#&gt; [1] 1 2 3</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $dat$bugsData$medianTx</span>
<span class="co">#&gt; [1] 2 3 1</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $dat$bugsData$medianBase</span>
<span class="co">#&gt; [1] 1 2 3</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $dat$bugsData$Bstudy</span>
<span class="co">#&gt; [1] 1 2</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $dat$bugsData$Btx</span>
<span class="co">#&gt; [1] 1 2</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $dat$bugsData$Bbase</span>
<span class="co">#&gt; [1] 1 1</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $dat$bugsData$medianN</span>
<span class="co">#&gt; [1] 45 45 10</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $dat$bugsData$medianR</span>
<span class="co">#&gt; [1] 22 22  5</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $dat$bugsData$median</span>
<span class="co">#&gt; [1] 14.0 18.0 15.1</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $dat$bugsData$medianNObs</span>
<span class="co">#&gt; [1] 3</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $dat$bugsData$Bn</span>
<span class="co">#&gt; [1] 38 33</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $dat$bugsData$Br</span>
<span class="co">#&gt; [1] 34 27</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $dat$bugsData$BnObs</span>
<span class="co">#&gt; [1] 2</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $dat$txList</span>
<span class="co">#&gt; [1] "X" "Y" "Z"</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $data_type</span>
<span class="co">#&gt; [1] "hr_data"       "surv_bin_data" "med_data"     </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $bugs_params</span>
<span class="co">#&gt; $bugs_params$PROG</span>
<span class="co">#&gt; [1] "openBugs"</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $bugs_params$N.BURNIN</span>
<span class="co">#&gt; [1] 10</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $bugs_params$N.SIMS</span>
<span class="co">#&gt; [1] 150</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $bugs_params$N.CHAINS</span>
<span class="co">#&gt; [1] 2</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $bugs_params$N.THIN</span>
<span class="co">#&gt; [1] 1</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $bugs_params$PAUSE</span>
<span class="co">#&gt; [1] TRUE</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $bugs_params$run_bugs</span>
<span class="co">#&gt; [1] TRUE</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $bugs_fn</span>
<span class="co">#&gt; function(...)</span>
<span class="co">#&gt;         R2OpenBUGS::bugs(...)</span>
<span class="co">#&gt; &lt;bytecode: 0x0000000016fce310&gt;</span>
<span class="co">#&gt; &lt;environment: 0x0000000016fd2268&gt;</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $is_random</span>
<span class="co">#&gt; [1] FALSE</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $refTx</span>
<span class="co">#&gt; [1] "X"</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $effectParam</span>
<span class="co">#&gt; [1] "beta"</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $modelParams</span>
<span class="co">#&gt;        hr_data       med_data                </span>
<span class="co">#&gt;      "totLdev" "totmediandev"    "totresdev" </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $label</span>
<span class="co">#&gt; [1] ""</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $endpoint</span>
<span class="co">#&gt; [1] ""</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; attr(,"class")</span>
<span class="co">#&gt; [1] "nma"</span>
<span class="co">#&gt; attr(,"CALL")</span>
<span class="co">#&gt; attr(,"CALL")$subDataHR</span>
<span class="co">#&gt; subDataHR</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; attr(,"CALL")$subDataMed</span>
<span class="co">#&gt; subDataMed</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; attr(,"CALL")$subDataBin</span>
<span class="co">#&gt; subDataBin</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; attr(,"CALL")$bugs_params</span>
<span class="co">#&gt; bugs_params</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; attr(,"CALL")$is_random</span>
<span class="co">#&gt; RANDOM</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; attr(,"CALL")$data_type</span>
<span class="co">#&gt; data_type</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; attr(,"CALL")$refTx</span>
<span class="co">#&gt; REFTX</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; attr(,"CALL")$effectParam</span>
<span class="co">#&gt; [1] "beta"</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; attr(,"CALL")$label</span>
<span class="co">#&gt; [1] ""</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; attr(,"CALL")$endpoint</span>
<span class="co">#&gt; [1] ""</span></code></pre></div>
<p>We can view the network graph.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://statnet.org" class="external-link">sna</a></span><span class="op">)</span>
<span class="fu"><a href="../reference/plotNetwork.html">plotNetwork</a></span><span class="op">(</span><span class="va">nma_model</span><span class="op">)</span></code></pre></div>
<p><img src="how-to-use-nma-survival-test-data_files/figure-html/unnamed-chunk-9-1.png" width="576"></p>
</div>
<div class="section level3">
<h3 id="run-mcmc">Run MCMC<a class="anchor" aria-label="anchor" href="#run-mcmc"></a>
</h3>
<p>The NMA MCMC function calls the appropriate BUGS model.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">nma_res</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/NMA_run.html">NMA_run</a></span><span class="op">(</span><span class="va">nma_model</span>, save <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>
<span class="co">#&gt; ====== RUNNING BUGS MODEL</span>

<span class="va">nma_res</span>
<span class="co">#&gt; Inference for Bugs model at "C:\Users\n8tha\AppData\Local\Temp\Rtmp4oXQBf/bugs_model.txt", </span>
<span class="co">#&gt;  2 chains, each with 160 iterations (first 10 discarded)</span>
<span class="co">#&gt;  n.sims = 300 iterations saved</span>
<span class="co">#&gt;               mean    sd  2.5%   25%   50%   75% 97.5% Rhat n.eff</span>
<span class="co">#&gt; beta[2]        0.0   0.9  -1.0  -0.7  -0.4   0.9   1.2  6.4     2</span>
<span class="co">#&gt; beta[3]       -0.7   0.8  -2.2  -1.3  -0.7   0.0   0.6  4.8     2</span>
<span class="co">#&gt; totLdev      132.3  54.9  40.9  87.6 125.8 180.9 249.7  1.0   300</span>
<span class="co">#&gt; totmediandev 226.8 154.8  48.6 123.0 172.8 265.6 558.3  1.1    23</span>
<span class="co">#&gt; totresdev    359.0 198.5  90.5 210.8 310.3 457.3 765.4  1.1    45</span>
<span class="co">#&gt; deviance     500.6 149.6 300.0 390.3 466.9 616.4 799.6  1.1    48</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; For each parameter, n.eff is a crude measure of effective sample size,</span>
<span class="co">#&gt; and Rhat is the potential scale reduction factor (at convergence, Rhat=1).</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; DIC info (using the rule, pD = Dbar-Dhat)</span>
<span class="co">#&gt; pD = 143.5 and DIC = 644.1</span>
<span class="co">#&gt; DIC is an estimate of expected predictive error (lower deviance is better).</span></code></pre></div>
</div>
<div class="section level3">
<h3 id="reconfigure-model">Reconfigure model<a class="anchor" aria-label="anchor" href="#reconfigure-model"></a>
</h3>
<p>It is simple to modify an existing analysis without repeating the
previous steps. For example, we can run the NMA for a random effects
rather than a fixed effects model version of the same model.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">nma_model2</span> <span class="op">&lt;-</span>
  <span class="fu"><a href="../reference/NMA_update.html">NMA_update</a></span><span class="op">(</span><span class="va">nma_model</span>,
             is_random <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">nma_res2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/NMA_run.html">NMA_run</a></span><span class="op">(</span><span class="va">nma_model2</span>, save <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>
<span class="co">#&gt; ====== RUNNING BUGS MODEL</span>

<span class="va">nma_res2</span>
<span class="co">#&gt; Inference for Bugs model at "C:\Users\n8tha\AppData\Local\Temp\Rtmp4oXQBf/bugs_model.txt", </span>
<span class="co">#&gt;  2 chains, each with 160 iterations (first 10 discarded)</span>
<span class="co">#&gt;  n.sims = 300 iterations saved</span>
<span class="co">#&gt;               mean   sd  2.5%   25%   50%   75% 97.5% Rhat n.eff</span>
<span class="co">#&gt; beta[2]        0.5  0.6  -0.7  -0.1   0.4   1.1   1.6  1.8     5</span>
<span class="co">#&gt; beta[3]       -1.1  0.3  -1.6  -1.4  -1.0  -0.9  -0.6  1.9     4</span>
<span class="co">#&gt; totLdev       28.0 19.8   5.6  14.1  21.5  36.2  76.3  1.3    10</span>
<span class="co">#&gt; totmediandev  52.3 51.1  14.2  27.0  37.1  54.3 200.6  1.3     9</span>
<span class="co">#&gt; totresdev     80.4 62.9  25.9  44.2  60.2  88.1 258.0  1.4     7</span>
<span class="co">#&gt; deviance     145.7 61.0 114.7 118.7 123.8 143.4 355.2  1.0   300</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; For each parameter, n.eff is a crude measure of effective sample size,</span>
<span class="co">#&gt; and Rhat is the potential scale reduction factor (at convergence, Rhat=1).</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; DIC info (using the rule, pD = Dbar-Dhat)</span>
<span class="co">#&gt; pD = 27.4 and DIC = 173.2</span>
<span class="co">#&gt; DIC is an estimate of expected predictive error (lower deviance is better).</span></code></pre></div>
</div>
<div class="section level3">
<h3 id="plot-and-tables">Plot and tables<a class="anchor" aria-label="anchor" href="#plot-and-tables"></a>
</h3>
<p>BUGS plots are available for diagnosing the performance.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">diagnostics</span><span class="op">(</span><span class="va">nma_res2</span>, save <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<p>Different NMA tables can be created. They can provide a record of the
analysis.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/write_data_to_file.html">write_data_to_file</a></span><span class="op">(</span><span class="va">nma_model</span><span class="op">)</span>
<span class="fu"><a href="../reference/write_results_table.html">write_results_table</a></span><span class="op">(</span><span class="va">nma_model</span>, <span class="va">nma_res</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/pairwiseTable.html">pairwiseTable</a></span><span class="op">(</span><span class="va">nma_model</span>, <span class="va">nma_res</span><span class="op">)</span>
<span class="co">#&gt;   X                  Y                  Z                 </span>
<span class="co">#&gt; X "1 (1,1)"          "1.47 (0.29,2.72)" "2.11 (0.55,9.12)"</span>
<span class="co">#&gt; Y "0.68 (0.37,3.47)" "1 (1,1)"          "2.29 (1.1,5.08)" </span>
<span class="co">#&gt; Z "0.47 (0.11,1.82)" "0.44 (0.2,0.91)"  "1 (1,1)"</span></code></pre></div>
<p>Currently available NMA plots are a treatment effect forest plot of
posterior samples and a rank probability grid.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/txEffectPlot.html">txEffectPlot</a></span><span class="op">(</span><span class="va">nma_model</span>, <span class="va">nma_res</span><span class="op">)</span></code></pre></div>
<p><img src="how-to-use-nma-survival-test-data_files/figure-html/unnamed-chunk-16-1.png" width="768"></p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/rankProbPlot.html">rankProbPlot</a></span><span class="op">(</span><span class="va">nma_model</span>, <span class="va">nma_res</span><span class="op">)</span></code></pre></div>
<p><img src="how-to-use-nma-survival-test-data_files/figure-html/unnamed-chunk-16-2.png" width="768"></p>
<p>It’s also possible to create all of the BUGS and output plots and
table functions together and write to an analysis folder.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/nma_outputs.html">nma_outputs</a></span><span class="op">(</span><span class="va">nma_res2</span>, save <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
</div>
</div>
<div class="section level2 unnumbered">
<h2 class="unnumbered" id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-Woods2010" class="csl-entry">
Woods, Beth S., Neil Hawkins, and David A. Scott. 2010. <span>“<span class="nocase">Network meta-analysis on the log-hazard scale, combining
count and hazard ratio statistics accounting for multi-arm trials: A
tutorial</span>.”</span> <em>BMC Medical Research Methodology</em> 10.
<a href="https://doi.org/10.1186/1471-2288-10-54" class="external-link">https://doi.org/10.1186/1471-2288-10-54</a>.
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Nathan Green.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a>
2.0.2.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
